<svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink="http://www.w3.org/1999/xlink" version='1.1' width='800' height='600' viewBox="0 0 800 600"
	onload="InitDraw(evt)"
	onmousedown="Grab(evt)"
	onmousemove="Drag(evt)"
	onmouseup="Drop(evt)"
	onclick="OnClick()"
	style="cursor:pointer;">
	<metadata>Author: Simon Pavlin, 2021</metadata>
	<title>Ebbinghaus illusion</title>
	<style>
      .draggable {
        cursor: move;
    }
    </style>
	<defs>
		<g id="circ">
			<circle class="draggable" cx="0" cy="0" r="25" fill="#A9C228" stroke="black"/>
		</g>
	</defs>
	<rect id="BackDrop" x="0" y="0" width="800" height="600" pointer-events="all" fill="#f8f8f8" />

 <script><![CDATA[

var svg = document.getElementsByTagName('svg')[0];
var svgns = "http://www.w3.org/2000/svg";

var SVGDocument = null;
var SVGRoot = null;

var TrueCoords = null;
var GrabPoint = null;
var BackDrop = null;
var DragTarget = null;

var circles = [];

function Init() {
 	var target = document.createElementNS('http://www.w3.org/2000/svg', 'use');
    target.setAttributeNS('http://www.w3.org/1999/xlink', "xlink:href", "#circ");
    target.setAttribute("transform", "translate(200,300)");
	target.setAttribute("id", "Circle1");
    svg.appendChild(target);

	var target = document.createElementNS('http://www.w3.org/2000/svg', 'use');
    target.setAttributeNS('http://www.w3.org/1999/xlink', "xlink:href", "#circ");
    target.setAttribute("transform", "translate(500,300)");
	target.setAttribute("id", "Circle2");
    svg.appendChild(target);

	for (var i = 0; i < 8; i += 1) {
		var circle = document.createElementNS(svgns, 'circle');
		circle.setAttribute('cx', 200);
		circle.setAttribute('cy', 255);
		circle.setAttribute('r', 15);
		circle.setAttribute('stroke', 'black');
		circle.setAttribute('fill', '#CCD3D9');
		circle.setAttribute('transform', 'rotate(' + i*45 + ',200,300)');
		svg.appendChild(circle);
		circles.push(circle);
	}

	for (var j = 0; j < 6; j += 1) {
		var circle = document.createElementNS(svgns, 'circle');
		circle.setAttribute('cx', 500);
		circle.setAttribute('cy', 220);
		circle.setAttribute('r', 37);
		circle.setAttribute('stroke', 'black');
		circle.setAttribute('fill', '#CCD3D9');
		circle.setAttribute('transform', 'rotate(' + j*60 + ',500,300)');
		svg.appendChild(circle);
		circles.push(circle);
	}
}

var hide = true;

function OnClick() {
	for (var i = 0; i < circles.length; i++) {
		if(hide) {
		circles[i].setAttribute('opacity', 0);
	} else {
		circles[i].setAttribute('opacity', 1);
	}
	
	}
	hide = !hide;
}

      function InitDraw(evt) {
         SVGDocument = evt.target.ownerDocument;
         SVGRoot = SVGDocument.documentElement;
         TrueCoords = SVGRoot.createSVGPoint();
         GrabPoint = SVGRoot.createSVGPoint();
         BackDrop = SVGDocument.getElementById('BackDrop');
		Init();
      }

      function Grab(evt) {
         var targetElement = evt.target;
         if (BackDrop != targetElement) {
			if(targetElement.id === "Circle1" || targetElement.id === "Circle2") {;
		        DragTarget = targetElement;
		        DragTarget.parentNode.appendChild( DragTarget );
		        DragTarget.setAttribute('pointer-events', 'none');
		        var transMatrix = DragTarget.getCTM();
		        GrabPoint.x = TrueCoords.x - Number(transMatrix.e);
		        GrabPoint.y = TrueCoords.y - Number(transMatrix.f);
			}
         }
      };

      function Drag(evt) {
         GetTrueCoords(evt);
         if (DragTarget) {
            var newX = TrueCoords.x - GrabPoint.x;
            var newY = TrueCoords.y - GrabPoint.y;
            DragTarget.setAttribute('transform', 'translate(' + newX + ',' + newY + ')');
         }
      };


      function Drop(evt) {
         if (DragTarget) {
            var targetElement = evt.target;
            DragTarget.setAttribute('pointer-events', 'all');
            DragTarget = null;
         }
      };


      function GetTrueCoords(evt) {
         var newScale = SVGRoot.currentScale;
         var translation = SVGRoot.currentTranslate;
         TrueCoords.x = (evt.clientX - translation.x)/newScale;
         TrueCoords.y = (evt.clientY - translation.y)/newScale;
      };


   ]]></script>
</svg>
