<svg width="500" height="500" viewBox="100 100 500 500"
     xmlns="http://www.w3.org/2000/svg"
     style="background:#f8f8f8; cursor:pointer;">
  <title>Archer-T nagib navzdol - 3s animacija</title>

  <!-- TRUP -->
  <g id="trunk" stroke="#303fa1" stroke-width="20" fill="none" stroke-linecap="round" stroke-linejoin="round">
    <circle cx="400" cy="210" r="15" stroke-width="15px" />
    <line x1="400" y1="250" x2="400" y2="325" />
    <line x1="340" y1="250" x2="490" y2="250" />
	<g id="t_sign" style="display:none;">
		<line x1="400" y1="250" x2="400" y2="325" stroke="red" stroke-width="5px" />
		<line x1="350" y1="250" x2="450" y2="250" stroke="red" stroke-width="5px" />
	</g>
    <path d="M460,140 Q570,250 460,360" stroke-width="15px"/>
  </g>

  <!-- TLA -->
  <g id="ground" transform="rotate(0 440 460)">
    <line x1="250" y1="460" x2="550" y2="460" stroke="silver" stroke-width="10" stroke-linecap="round"/>
  </g>

  <!-- LEVA NOGA -->
  <polyline id="leftLeg" points="400,350 380,405 360,460" stroke="#303fa1" stroke-width="20" fill="none" stroke-linecap="round" stroke-linejoin="round"/>

  <!-- DESNA NOGA -->
  <polyline id="rightLeg" points="400,350 420,405 440,460" stroke="#303fa1" stroke-width="20" fill="none" stroke-linecap="round" stroke-linejoin="round"/>

  <!-- Zelena kljukica (skrita na začetku) -->
  <text id="checkmark" x="350" y="310" font-size="50" stroke-width="5" fill="green" style="display:none;">✔</text>

  <script><![CDATA[
    const svg = document.currentScript.parentElement;
    const trunk = svg.getElementById("trunk");
    const ground = svg.getElementById("ground");
    const rightLeg = svg.getElementById("rightLeg");
    const leftLeg = svg.getElementById("leftLeg");

    const hip = {x:400, y:350};
    const footRight0 = {x:440, y:460};  // desno stopalo
    const footLeft0 = {x:360, y:460};   // levo stopalo
    const pivot = {x:440, y:460};       // tla okrog desnega stopala
    const L = 55; // dolžina stegna/spodnjega dela noge


function showMark() {
	const checkmark = svg.getElementById("checkmark");
	const t_sign = svg.getElementById("t_sign");
	checkmark.style.display = 'block'; // prikaži kljukico
	t_sign.style.display= 'block';
}

function hideMark() {
	const checkmark = svg.getElementById("checkmark");
	const t_sign = svg.getElementById("t_sign");
	checkmark.style.display = 'none'; // skrij kljukico
	t_sign.style.display= 'none';
}
    function rotatePoint(x, y, cx, cy, angleDeg) {
      const rad = angleDeg * Math.PI / 180;
      const dx = x - cx;
      const dy = y - cy;
      return {
        x: cx + dx*Math.cos(rad) - dy*Math.sin(rad),
        y: cy + dx*Math.sin(rad) + dy*Math.cos(rad)
      };
    }

    function computeKnee(hip, foot, L, invert=false) {
      const dx = foot.x - hip.x;
      const dy = foot.y - hip.y;
      const dist = Math.sqrt(dx*dx + dy*dy);
      const D = Math.min(Math.max(dist,0.0001),2*L);
      const a = D/2;
      const h = Math.sqrt(Math.max(L*L - a*a,0));
      const mx = hip.x + dx/2;
      const my = hip.y + dy/2;
      const ux = dx / D;
      const uy = dy / D;
      const px = invert ? uy : -uy; // leva noga koleno obrnjeno v drugo smer
      const py = invert ? -ux : ux;
      return {x: mx - px*h, y: my - py*h};
    }

    svg.addEventListener("click", () => {
	  hideMark();
      const duration = 3000;
      const start = performance.now();

      function animate(now) {
        const t = Math.min((now - start)/duration, 1);
        const angle = 20 * t;

        // tla
        ground.setAttribute("transform", `rotate(${angle} ${pivot.x} ${pivot.y})`);

        // desna noga
        const footRight = rotatePoint(footRight0.x, footRight0.y, pivot.x, pivot.y, angle);
        const kneeRight = computeKnee(hip, footRight, L);
        rightLeg.setAttribute("points", `${hip.x},${hip.y} ${kneeRight.x},${kneeRight.y} ${footRight.x},${footRight.y}`);

        // leva noga
        const footLeft = rotatePoint(footLeft0.x, footLeft0.y, pivot.x, pivot.y, angle);
        const kneeLeft = computeKnee(hip, footLeft, L, true);
        leftLeg.setAttribute("points", `${hip.x},${hip.y} ${kneeLeft.x},${kneeLeft.y} ${footLeft.x},${footLeft.y}`);

        // trup se rahlo vrti (npr. polovico kota tal)
        trunk.setAttribute("transform", `rotate(${angle} 400 325)`);

		if (t >= 1) {
			showMark();
        } else {
			requestAnimationFrame(animate);
		}
      }

      requestAnimationFrame(animate);
    });
  ]]></script>
</svg>
