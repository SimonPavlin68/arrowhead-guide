{% extends "base.html" %}

{% block header %}
  {{ super() }}

  <script>
    function initHeaderUser() {
        // const user = localStorage.getItem("arrowheadUser");
		const user = getWithExpiry("arrowheadUser")
        if (!user) return;

        // retry dokler headerInner ni na voljo
        const interval = setInterval(() => {
            const headerInner = document.querySelector(".md-header__inner");
            if (!headerInner) return;

            clearInterval(interval);

            if (document.getElementById("userChip")) return;

            const chip = document.createElement("div");
            chip.id = "userChip";

            const spanUser = document.createElement("span");
            spanUser.textContent = user;
            spanUser.style.marginRight = "8px";

            const btnLogout = document.createElement("button");
            btnLogout.textContent = "Ã—";
            btnLogout.style.cursor = "pointer";
            btnLogout.style.background = "none";
            btnLogout.style.border = "none";
            btnLogout.style.color = "white";
            btnLogout.style.fontWeight = "bold";
            btnLogout.onclick = () => {
                localStorage.removeItem("arrowheadUser");
                location.reload();
            };

            chip.appendChild(spanUser);
            chip.appendChild(btnLogout);

            // Material-like styling
            chip.style.background = "rgba(255,255,255,0.15)";
            chip.style.padding = "4px 12px";
            chip.style.borderRadius = "20px";
            chip.style.fontSize = "0.8rem";
            chip.style.color = "white";
            chip.style.fontWeight = "500";
            chip.style.display = "flex";
            chip.style.alignItems = "center";
            chip.style.height = "32px";
            chip.style.marginLeft = "auto";
            chip.style.whiteSpace = "nowrap";

            headerInner.appendChild(chip);
        }, 50); // preverja vsakih 50ms
    }

    document.addEventListener("DOMContentLoaded", initHeaderUser);
    window.initHeaderUser = initHeaderUser;
  </script>
{% endblock %}

